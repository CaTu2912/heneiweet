<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="shop.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-danger p-3">
        <div class="container">
            <a class="navbar-brand text-white fw-bold" href="#">Sweet Treats</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <form class="d-flex ms-auto me-3" onsubmit="redirectToSearch(event)">
                    <input class="form-control me-2" type="search" id="searchInput" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
                    <button class="btn btn-light" type="submit"><i class="bi bi-search"></i></button>
                </form>             
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link text-white" href="./index.html">Trang ch·ªß</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" id="productsDropdown" data-bs-toggle="dropdown">S·∫£n ph·∫©m</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="./banh.html">B√°nh</a></li>
                            <li><a class="dropdown-item" href="./keo.html">K·∫πo</a></li>
                            <li><a class="dropdown-item" href="#">Socola</a></li>
                            <li><a class="dropdown-item" href="#">Tr√°i c√¢y s·∫•y</a></li>
                            <li><a class="dropdown-item" href="#">Khoai t√¢y</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link text-white" href="./giohang.html"><i class="bi bi-cart3"></i></a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#">Li√™n h·ªá</a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container mt-4">
        <h2 class="text-danger">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>
        <table class="table table-bordered text-center">
            <thead class="table-dark">
                <tr>
                    <th>·∫¢nh</th>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Gi√°</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>T·ªïng</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody id="cart-items"></tbody>
        </table>
        <h4 class="mt-3">T·ªïng ti·ªÅn: <span id="total-price" class="text-dark fw-bold">0</span>ƒë</h4>
        <button class="btn btn-warning mt-3" id="checkout">üõçÔ∏è Thanh to√°n</button>
        <button class="btn btn-danger mt-3" id="clear-cart">üóëÔ∏è X√≥a gi·ªè h√†ng</button>
    </div>
    
    <footer class="text-center py-3 bg-danger text-white">
        <div class="container">
            <p>&copy; Henei Sweet.</p>
            <p>ƒê·ªãa ch·ªâ: An H√≤a, Ninh Ki·ªÅu, C·∫ßn Th∆°</p>
            <p>ƒêi·ªán tho·∫°i: <a href="tel:0987456123" class="text-white">0987.456.123</a></p>
            <p>Email: <a href="mailto:henei@sweet.vn" class="text-white">henei@sweet.vn</a></p>
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            const cartTable = document.getElementById("cart-items");
            const totalPriceElement = document.getElementById("total-price");
            
            function saveCart() {
                localStorage.setItem("cart", JSON.stringify(cart));
            }

            function updateCartUI() {
                cartTable.innerHTML = "";
                let totalPrice = 0;
                cart.forEach((item, index) => {
                    let itemTotal = item.price * item.quantity;
                    totalPrice += itemTotal;
                    let tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td><img src="${item.img}" alt="${item.name}" width="80" height="80"></td>
                        <td>${item.name}</td>
                     <td>${item.price.toLocaleString('vi-VN')},000ƒë</td>
                        <td>
                            <button class="btn btn-sm btn-outline-secondary decrease-quantity" data-index="${index}">‚àí</button>
                            <span class="mx-2">${item.quantity}</span>
                            <button class="btn btn-sm btn-outline-secondary increase-quantity" data-index="${index}">+</button>
                        </td>
                     <td><strong>${itemTotal.toLocaleString('vi-VN')},000ƒë</strong></td>

                        <td><button class="btn btn-sm btn-danger remove-item" data-index="${index}">X√≥a</button></td>
                    `;
                    cartTable.appendChild(tr);
                });
                totalPriceElement.innerText = totalPrice.toLocaleString('vi-VN') + ',000';
                attachEventListeners();
            }

            function attachEventListeners() {
                document.querySelectorAll(".increase-quantity").forEach(button => {
                    button.addEventListener("click", function () {
                        let index = this.dataset.index;
                        cart[index].quantity++;
                        saveCart();
                        updateCartUI();
                    });
                });
                document.querySelectorAll(".decrease-quantity").forEach(button => {
                    button.addEventListener("click", function () {
                        let index = this.dataset.index;
                        if (cart[index].quantity > 1) {
                            cart[index].quantity--;
                        } else {
                            cart.splice(index, 1);
                        }
                        saveCart();
                        updateCartUI();
                    });
                });
                document.querySelectorAll(".remove-item").forEach(button => {
        button.addEventListener("click", function () {
            let index = this.dataset.index;

            Swal.fire({
                title: "B·∫°n c√≥ ch·∫Øc ch·∫Øn?",
                text: "S·∫£n ph·∫©m s·∫Ω b·ªã x√≥a kh·ªèi gi·ªè h√†ng.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "X√≥a",
                cancelButtonText: "H·ªßy"
            }).then((result) => {
                if (result.isConfirmed) {
                    cart.splice(index, 1); // X√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng
                    saveCart();
                    updateCartUI();
                    Swal.fire("ƒê√£ x√≥a!", "S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c x√≥a kh·ªèi gi·ªè h√†ng.", "success");
                }
            });
        });
    });
            }
            
            document.getElementById("clear-cart").addEventListener("click", function () {
                localStorage.removeItem("cart");
                cart = [];
                updateCartUI();
            });
            
            updateCartUI();
        });
        /*chuy·ªÉn h∆∞·ªõng sang trang thanh to√°n*/
        document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("checkout").addEventListener("click", function () {
        // L·∫•y gi·ªè h√†ng t·ª´ localStorage
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        if (cart.length === 0) {
            Swal.fire("Gi·ªè h√†ng tr·ªëng!", "Vui l√≤ng th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng tr∆∞·ªõc khi thanh to√°n.", "warning");
        } else {
            window.location.href = "thanhtoan.html"; // ƒêi·ªÅu h∆∞·ªõng sang trang thanh to√°n
        }
    });
});

    </script>
</body>
</html>